<!doctype html> <!-- Minimal Mistakes Jekyll Theme 4.16.4 by Michael Rose Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes Free for personal and commercial use under the MIT license https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE --> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/minimal-mistakes.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=stylesheet  href="/css/custom.css"> <link rel=icon  href="/assets/favicon.png"> <!--[if IE ]> <style> /* old IE unsupported flexbox fixes */ .greedy-nav .site-title { padding-right: 3em; } .greedy-nav button { position: absolute; top: 0; right: 0; height: 100%; } </style> <![endif]--> <title>Dithering in Blender</title> <body class=layout--single > <div class=masthead > <div class=masthead__inner-wrap > <div class=masthead__menu > <nav id=site-nav  class=greedy-nav > <a class=site-title  href="/"><img src="/assets/images/BE_logo_BLKonWHT_600x600.png" style="height: 100px;"></a> <ul class=visible-links > <li class=masthead__menu-item ><a href="/blog/" >Blog</a> <li class=masthead__menu-item ><a href="/resume/" >Résumé</a> </ul> <button class="greedy-nav__toggle hidden" type=button > <span class=visually-hidden >Toggle menu</span> <div class=navicon ></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class=initial-content > <div id=main  role=main > <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class=author__avatar > <img src="/assets/images/braden_eliason_circle.png" alt="Braden Eliason" itemprop=image > </div> <div class=author__content > <h3 class=author__name  itemprop=name >Braden Eliason</h3> <p class=author__bio  itemprop=description >engineer, inventor, designer, entrepreneur, and all-around nerd</p> </div> <div class=author__urls-wrapper > <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop=homeLocation  itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden=true ></i> <span itemprop=name >Munich, Germany</span> <li><a href="https://github.com/bradeneliason" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden=true ></i> GitHub</a> <li><a href="https://www.linkedin.com/in/bradeneliason/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden=true ></i> LinkedIn</a> </ul> </div> </div> </div> <div class=franklin-content > <div class=page-header > <h1>Dithering in Blender</h1> <div class=subheader ><span class=post-date >June 13, 2020</span> <div class=tags ><a href="/blog/#articles_by_tag/" id=tag-icon ><svg width=15  height=15  viewBox="0 0 512 512"><defs><style>.cls-1{fill:#141f38}</style></defs><path d="M 48.284271,8.2842712 A 40,40 0 0 0 8.2842712,48.284271 V 192.28427 A 96.568542,96.568542 0 0 0 36.569427,260.56943 L 267.99911,491.99911 a 40,40 0 0 0 56.57032,0 L 491.99911,324.56943 a 40,40 0 0 0 0,-56.57032 L 260.56943,36.569427 A 96.568542,96.568542 0 0 0 192.28427,8.2842712 Z M 136.28427,104.28427 a 32,32 0 0 1 32,32 32,32 0 0 1 -32,32 32,32 0 0 1 -32,-32 32,32 0 0 1 32,-32 z" /></svg></a><a href="/tag/blender/">blender</a>, <a href="/tag/julia/">julia</a></div></div></div> <p>I wanted to create a 3D render which emulated the retro video game aesthetic. To accomplish this I created a compositing node setup in Blender to apply ordered dithering to an image. Below is a description of what dithering is and how it can be applied to a rendering in Blender using compositing nodes. Note: I have the image files of the dither matrices needed for this effect free to download below so that you don&#39;t need to recreate them.</p> <h2 id=what_is_dithering ><a href="#what_is_dithering" class=header-anchor >What is Dithering?</a></h2> <p>Dithering an image is adding noise to it. Typically we want as little noise in an image as possible, so why would we want to add noise? Early computer displays had a limited number of colors that could be displayed. If you wanted to smoothly blend one color into another, this limited color palette would result in blocks colors with large jumps between colors. This is is know as color banding. This color banding is the visual result of quantization error. Quantization error occurs when a smoothly varying input value is rounded to a limited number of output levels.</p> <p>Images with this color banding are accurate at the pixel level. That is, every pixel is displayed with the color as close to the original as possible &#40;minimal pixel quantization error&#41;. But this per-pixel accuracy often results in very ugly images. Instead consider treating a block of pixels as a unit instead of the single pixel. We perceive the average of a block of pixels and this pixel grouping allows for more possible perceived gradations. The dithered gradient in the image below is composed of only black and white pixels, but the blocks of pixels are perceived as gradations of grey. So while dither causes the quantization error of the image to increase at the pixel level, the result is perceived as closer to the input gradient. Thus dithering is adding noise to an image in such a way that it reduces the perceptual cost of quantization errors.</p> <img src="/assets/blog_images/blender_dithering_01_fig1.png" alt=""> <p>There are two way to think about this dithering noise: adding noise and then rounding or having a different threshold across a block of pixels. To dither a block of pixels we can add a block of noise and round up and down with a threshold of 50&#37;. The noise we add is set up so that a block of 50&#37; grey pixels would have half its pixels rounded up to white and half its pixels rounded down to black. Similarly, a block of 25&#37; percent grey would have noise added such that rounding with a 50&#37; threshold results in about 25&#37; of the pixels being white. The other way to think about this having a different threshold for each pixel within a block. These methods are equivalent, but I wanted to make it clear that the threshold matrices that I am creating below have the effect of adding noise.</p> <h2 id=dithering_matrices ><a href="#dithering_matrices" class=header-anchor >Dithering Matrices</a></h2> <p><pre><code class="julia hljs"><span class=hljs-keyword >using</span> Images

<span class=hljs-keyword >function</span> bayer_matrix(size=<span class=hljs-number >1</span>)
    M = [<span class=hljs-number >0</span> <span class=hljs-number >2</span>; <span class=hljs-number >3</span> <span class=hljs-number >1</span>]
    
    <span class=hljs-keyword >for</span> i=<span class=hljs-number >2</span>:size
        M = @. [(<span class=hljs-number >4</span>*M) (<span class=hljs-number >4</span>*M+<span class=hljs-number >2</span>); (<span class=hljs-number >4</span>*M+<span class=hljs-number >3</span>) (<span class=hljs-number >4</span>*M+<span class=hljs-number >1</span>)]
    <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >return</span> M./ <span class=hljs-number >2</span>^(<span class=hljs-number >2</span>*size)
<span class=hljs-keyword >end</span>

img_size = <span class=hljs-number >128</span>
imgs = []
<span class=hljs-keyword >for</span> n = <span class=hljs-number >1</span>:<span class=hljs-number >4</span>
    bm = bayer_matrix(n)
    reps = convert(<span class=hljs-built_in >Int</span>, img_size/<span class=hljs-number >2</span>^n)
    bm = repeat(bm, inner=(reps,reps))
    push!(imgs, bm)
<span class=hljs-keyword >end</span>
padimg = ones((<span class=hljs-number >128</span>, <span class=hljs-number >32</span>))
output = hcat(imgs[<span class=hljs-number >1</span>], padimg, imgs[<span class=hljs-number >2</span>], padimg, imgs[<span class=hljs-number >3</span>], padimg, imgs[<span class=hljs-number >4</span>])</code></pre> <img src="/assets/scripts/output/blender_dithering_fig2.png" alt=""></p> <p>I created a quick function in Julia to create different threshold maps. These threshold maps &#40;Bayer matrices&#41; are square grey-scale images that are repeated to fill a region. The input image is compared pixel-by-pixel to the threshold map and set to white if it&#39;s above the pixel in the map and black if it&#39;s below the value in the map. The algorithm on the right can create threshold maps of many different sizes. This algorithm starts with a 2-by-2 matrix and iteratively expands the matrix by two in each dimension to reach a desired size. The final step is dividing the matrix by an appropriate factor of two to yield values between zero and one.</p> <p>Enlarged images created with the script are shown below. I&#39;ve also provided a link to download the image files so that you can jump right into Blender.</p> <h2 id=blender_compositing_with_dithering ><a href="#blender_compositing_with_dithering" class=header-anchor >Blender Compositing with Dithering</a></h2> <p>Below are two images of the default Blender monkey Suzanne with and without dithering. The image on the left has no dithering, so any pixel above the threshold of 50&#37; grey is set to white. The image on the right is still composes of only black and white pixels, but the dither produces the appearance of fine gradations of grey. I added a rendering pass to draw lines around certain contours of the model to give the model more form and produce a retro line art and shading appearance.</p> <p>Without Dithering: <img src="/assets/blog_images/blender_dithering_01_fig3a.png" alt=""></p> <p>With Dithering: <img src="/assets/blog_images/blender_dithering_01_fig3b.png" alt=""></p> <h2 id=send_nodes ><a href="#send_nodes" class=header-anchor >Send Nodes</a></h2> <p>Here are the Blender image compositor node setup for to produce the results above.</p> <img src="/assets/blog_images/blender_dithering_01_fig4.png" alt=""> <img src="/assets/blog_images/blender_dithering_01_fig5.png" alt=""> <h2 id=more_results ><a href="#more_results" class=header-anchor >More Results</a></h2> <p>Color Wheel Input: <img src="/assets/blog_images/blender_dithering_01_fig6a.png" alt=""></p> <p>Color Wheel Quantized: <img src="/assets/blog_images/blender_dithering_01_fig6b.png" alt=""></p> <p>Color Wheel Dithered: <img src="/assets/blog_images/blender_dithering_01_fig6c.png" alt=""></p> <p>Dithered Animation: <img src="/assets/blog_images/blender_dithering_01_fig7.gif" alt=""></p> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Braden Eliason. Last modified: June 02, 2024. <br> Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> <div class=page__footer > <footer> <div class=page__footer-follow > <ul class=social-icons > <li><strong>Follow:</strong> <li><a href="https://github.com/bradeneliason" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden=true ></i> GitHub</a> </ul> </div> <div class=page__footer-copyright >&copy;2024 Braden Eliason. Powered by <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel=nofollow >Minimal Mistakes</a>.</div> </footer> </div> <script src="/libs/minimal-mistakes/main.min.js"></script> <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin=anonymous ></script> <script src="/libs/highlight/highlight.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script>