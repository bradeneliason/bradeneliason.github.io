<!doctype html> <!-- Minimal Mistakes Jekyll Theme 4.16.4 by Michael Rose Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes Free for personal and commercial use under the MIT license https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE --> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/minimal-mistakes.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=stylesheet  href="/css/custom.css"> <link rel=icon  href="/assets/favicon.png"> <!--[if IE ]> <style> /* old IE unsupported flexbox fixes */ .greedy-nav .site-title { padding-right: 3em; } .greedy-nav button { position: absolute; top: 0; right: 0; height: 100%; } </style> <![endif]--> <title>Diagnostic Test Visualization: Part 2</title> <body class=layout--single > <div class=masthead > <div class=masthead__inner-wrap > <div class=masthead__menu > <nav id=site-nav  class=greedy-nav > <a class=site-title  href="/"><img src="/assets/images/BE_logo_BLKonWHT_600x600.png" style="height: 100px;"></a> <ul class=visible-links > <li class=masthead__menu-item ><a href="/blog/" >Blog</a> <li class=masthead__menu-item ><a href="/resume/" >Résumé</a> </ul> <button class="greedy-nav__toggle hidden" type=button > <span class=visually-hidden >Toggle menu</span> <div class=navicon ></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class=initial-content > <div id=main  role=main > <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class=author__avatar > <img src="/assets/images/braden_eliason_circle.png" alt="Braden Eliason" itemprop=image > </div> <div class=author__content > <h3 class=author__name  itemprop=name >Braden Eliason</h3> <p class=author__bio  itemprop=description >engineer, inventor, designer, entrepreneur, and all-around nerd</p> </div> <div class=author__urls-wrapper > <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop=homeLocation  itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden=true ></i> <span itemprop=name >Munich, Germany</span> <li><a href="https://github.com/bradeneliason" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden=true ></i> GitHub</a> <li><a href="https://www.linkedin.com/in/bradeneliason/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden=true ></i> LinkedIn</a> </ul> </div> </div> </div> <div class=franklin-content > <div class=page-header > <h1>Diagnostic Test Visualization: Part 2</h1> <div class=subheader ><span class=post-date >January 04, 2021</span> <div class=tags ><a href="/blog/#articles_by_tag/" id=tag-icon ><svg width=15  height=15  viewBox="0 0 512 512"><defs><style>.cls-1{fill:#141f38}</style></defs><path d="M 48.284271,8.2842712 A 40,40 0 0 0 8.2842712,48.284271 V 192.28427 A 96.568542,96.568542 0 0 0 36.569427,260.56943 L 267.99911,491.99911 a 40,40 0 0 0 56.57032,0 L 491.99911,324.56943 a 40,40 0 0 0 0,-56.57032 L 260.56943,36.569427 A 96.568542,96.568542 0 0 0 192.28427,8.2842712 Z M 136.28427,104.28427 a 32,32 0 0 1 32,32 32,32 0 0 1 -32,32 32,32 0 0 1 -32,-32 32,32 0 0 1 32,-32 z" /></svg></a><a href="/tag/julia/">julia</a></div></div></div> <p>I wanted to revisit a visualization that I made in a <a href="/blog/diagnostic_tests_01">previous post</a> which shows various parameters of diagnostics tests. I glossed over an issue in that previous post that I hope to address here. For a typical screening test, the visualization would be nearly unreadable because important regions on the graph would be too small to see. The box in the visualization is divided vertically by the prevalence of the condition. People with the condition are on the left and people without the condition are on the right. If the prevalence of the condition is low &#40;say 1&#37;&#41;, then the people with the condition &#40;both true positives and false negatives&#41; take up just a tiny sliver of the graph. The same problem occurs with very high prevalence for people without the condition. Similarly if the sensitivity or specificity is close to either 0 or 1, one of the boxes vanishes into a sliver.</p> <h2 id=to_a_new_scale ><a href="#to_a_new_scale" class=header-anchor >To a New Scale</a></h2> <p>Instead of fundamentally altering the diagram, I figured I could rescale the axes. Logarithmic scaling is for <a href="https://xkcd.com/1162/">quitters</a> and doesn&#39;t meet my needs, so I need a new scaling function. Probability is bounded between 0 and 1. I want to expand the regions on the ends of this range nearest to 0 and 1. On the low end, I need to distinguish two anomalous events with probabilities like 1&#37; and 0.1&#37;. Similarly, I would like the scale to distinguish two events which are nearly certain with probabilities like 99&#37; and 99.9&#37;. The scaling function should have an inverted &quot;S&quot; shape that gets steeper near 0 and 1. The steep regions of the graph have the effect of mapping a narrow range of inputs &#40;depicted on the x-axis&#41; into a larger region of output &#40;depicted on the y-axis&#41;.</p> <p><pre><code class=language-julia >using Plots

logit&#40;x&#41; &#61; log&#40;x/&#40;1-x&#41;&#41;

begin
	xx &#61; 0:0.001:1.0
	plot&#40; logit, xx, label&#61;&quot;Logit function&quot;, lw&#61;2&#41;
	plot&#33;&#40; xlim&#61;&#40;-0.1,1.1&#41;, ylim&#61;&#40;-4.1,4.1&#41;,
		legend&#61;:topleft, framestyle&#61;:zerolines,
		size&#61;&#40;400,400&#41;
	&#41;
end</code></pre> <img src="/assets/scripts/output/diagnostic_tests_02_fig2.svg" alt=""></p> <p>At first it seems like <a href="https://en.wikipedia.org/wiki/Logit">logit function</a> &#40;the inverse of the logistic function&#41; might be a good fit. This maps values between 0 and 1 to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi mathvariant=normal >∞</mi></mrow><annotation encoding="application/x-tex">-∞</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6667em;vertical-align:-0.0833em;"></span><span class=mord >−</span><span class=mord >∞</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo><mi mathvariant=normal >∞</mi></mrow><annotation encoding="application/x-tex">+∞</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6667em;vertical-align:-0.0833em;"></span><span class=mord >+</span><span class=mord >∞</span></span></span></span>. The one annoyance is that it takes a bounded range and maps it to an unbounded range. I wanted all the relevant features of my visualization to stay within a box so having a rescaling capable of shooting points off to infinity was not ideal.</p> <p>The function below satisfies all my requirements. The amount of scaling at the ends of the range is determined by a parameter <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>. One really convenient feature is that to invert the scaling, you only need to apply the same function with the reciprocal parameter.</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>f</mi><mo stretchy=false >(</mo><mi>x</mi><mo separator=true >;</mo><mi>k</mi><mo stretchy=false >)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mrow><mo fence=true >(</mo><mfrac><mn>1</mn><mi>x</mi></mfrac><mo>−</mo><mn>1</mn><mo fence=true >)</mo></mrow><mi>k</mi></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex"> f(x; k) = \frac{1}{1 + \left(\frac{1}{x} - 1 \right)^k} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.6505em;vertical-align:-1.329em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3214em;"><span style="top:-2.11em;"><span class=pstrut  style="height:3.089em;"></span><span class=mord ><span class=mord >1</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=minner ><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8451em;"><span style="top:-2.655em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord >1</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.089em;"><span style="top:-3.3029em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span><span style="top:-3.319em;"><span class=pstrut  style="height:3.089em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.766em;"><span class=pstrut  style="height:3.089em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.329em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>f</mi><mo stretchy=false >(</mo><mtext> </mtext><mi>f</mi><mo stretchy=false >(</mo><mi>x</mi><mo separator=true >;</mo><mi>k</mi><mo stretchy=false >)</mo><mo separator=true >;</mo><mtext> </mtext><mfrac><mn>1</mn><mi>k</mi></mfrac><mo stretchy=false >)</mo><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex"> f(\ f(x; k);\ \frac{1}{k})= x </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class=mopen >(</span><span class=mspace > </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=mclose >)</span><span class=mpunct >;</span><span class=mspace > </span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3214em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span> <p>I have to credit an answer from <a href="https://math.stackexchange.com/questions/1832177/sigmoid-function-with-fixed-bounds-and-variable-steepness-partially-solved/3253471#3253471">user Ron on math.StackExhange.com</a> with this equation. The question posted in that thread was relating to a sigmoidal function for an AI application, but Ron&#39;s equation is precisely what I was looking for.</p> <p>I&#39;ve found that a scaling factor of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>5</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{5}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1901em;vertical-align:-0.345em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8451em;"><span style="top:-2.655em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> is a really good balance. With this scaling factor probabilities of 0.1&#37;, 1&#37;, 10&#37;, and their inverses get remapped to close to 10&#37; divisions. This means I can create nearly regularly spaced ticks marks that fall on these preferred numbers.</p> <p><pre><code class=language-julia >using Plots

scale_fwd&#40;x, k&#61;5&#41; &#61; 1 / &#40;1 &#43; &#40;&#40;1/x&#41; - 1&#41;^&#40;1/k&#41;&#41;
scale_rev&#40;x, k&#61;5&#41; &#61; 1 / &#40;1 &#43; &#40;&#40;1/x&#41; - 1&#41;^&#40;k&#41;&#41;

begin
	xx &#61; 0:0.001:1.0
	plot&#40; scale_fwd, xx, label&#61;&quot;k&#61;5&quot;, color&#61;:dodgerblue1&#41;
	plot&#33;&#40;scale_rev, xx, label&#61;&quot;k&#61;1/5&quot;, ls&#61;:dash, color&#61;:dodgerblue1&#41;
	plot&#33;&#40;xx, xx, lw&#61;2, ls&#61;:dot, color&#61;:gray, label&#61;&quot;x&#61;y&quot;&#41;
	plot&#33;&#40;aspect_ratio&#61;:equal, 
		xlim&#61;&#40;-0.1,1.1&#41;, 
		ylim&#61;&#40;-0.1,1.1&#41;,
		legend&#61;:topleft,
		framestyle&#61;:zerolines,
		size&#61;&#40;600,600&#41;,
		lw&#61;2,
	&#41;
end</code></pre> <img src="/assets/scripts/output/diagnostic_tests_02_fig3.svg" alt=""></p> <h2 id=new_version_of_the_visualization ><a href="#new_version_of_the_visualization" class=header-anchor >New Version of the Visualization</a></h2> <p>I recreated my visualization from before but with axes rescaled. Take note of the light dashed lines and axis labels. The prevalence is only 2.2&#37; but this doesn&#39;t collapse the left side of the plot into a sliver. It goes without saying that this graph isn&#39;t meant to be used as a quantitative comparison.</p> <p>Logarithmic scales are ubiquitous for a reason; they have a very nice property that turns curves depicting exponential decays or growth into straight lines. I&#39;m not sure if there is a deeper mathematical elegance to the scale I&#39;ve chosen or if there is another scaling function that&#39;s better suited. My primary goal is to have a readable chart that helps me better understand diagnostic tests.</p> <p>I could have stopped with the image above, but I wasn&#39;t quite satisfied. I wanted my visualization to be interactive. I fired up an interactive notebook and created a visualization which reacts to input from a few sliders. The graphic was made with . isn&#39;t meant to be interactive, but notebooks are reactive. When I update the value of a slider, the notebook automatically updates all the affected code including the code which generates the visualization. I may explore using in the future for smoother animations. I&#39;m pretty pleased with the outcome and there&#39;s still a lot more that could be done.</p> <h2 id=wrapping_up ><a href="#wrapping_up" class=header-anchor >Wrapping Up</a></h2> <p>This project is mostly a vehicle for me to better remember the details of diagnostic testing. I&#39;ve been pretty unsatisfied with the descriptions and visualizations on this topic. Creating my own visualization gives me a motivation to dive into terminology of diagnostic tests and learn new skills &#40;such as creating interactive visualizations&#41;.</p> <p>There&#39;s still more work that could be done. For this first plot, I&#39;ve chosen to divide the plot first by people with and without the condition &#40;i.e. splitting vertically by the prevalence&#41;. The vertical segments are subsequently split based on the results of their test. I chose this order because the most commonly discussed parameters of a diagnostic test—sensitivity, specificity, and prevalence—can be read directly from the graph. You could just as easily flip the order of these cuts. That is, first cut the square horizontally by people&#39;s test results &#40;negative and positive&#41; and then cut the horizontal segments by people with and without the condition. On this alternative plot, parameters including positive predictive value &#40;PPV&#41;, false discovery rate &#40;FDR&#41;, false omission rate &#40;FOR&#41;, and negative predictive value &#40;NPV&#41; can be read off from the graph directly.</p> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Braden Eliason. Last modified: June 02, 2024. <br> Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> <div class=page__footer > <footer> <div class=page__footer-follow > <ul class=social-icons > <li><strong>Follow:</strong> <li><a href="https://github.com/bradeneliason" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden=true ></i> GitHub</a> </ul> </div> <div class=page__footer-copyright >&copy;2024 Braden Eliason. Powered by <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel=nofollow >Minimal Mistakes</a>.</div> </footer> </div> <script src="/libs/minimal-mistakes/main.min.js"></script> <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin=anonymous ></script>